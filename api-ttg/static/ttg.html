<!doctype html>
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0">
<html>

<head>
  <meta charset="UTF-8">
  <title>Document</title>
</head>
<style type="text/css">
  * {
    margin: 0;
  }

  html,
  body {
    width: 100%;
    height: 100%;
  }

  div {
    width: 100%;
    height: 100%;
    position: relative
  }

  iframe {
    width: 100%;
    height: 100%
  }
</style>

<body>
  <div>
    <iframe id="iframe"></iframe>
  </div>
</body>
<script type="text/javascript">
  var iframe = document.getElementById('iframe');
  var http = "http://ams-games.stg.ttms.co/casino/default/game/casino5.html?playerHandle=";
  var end = "&account=CNY&gameName=FireGoddessH5&gameType=0&gameId=1064&lang=zh-cn&lsdId=zero&deviceType=web&t=" + Date.now();
  function GetQueryString(name) {
    var reg = new RegExp("(^|&)" + name + "=([^&]*)(&|$)");
    var r = window.location.search.substr(1).match(reg);
    if (r != null) return unescape(r[2]); return null;
  }
  var key = location.href.split("=")[1];

  var gameId = GetQueryString('gameId'); // 游戏ID
  var userId = GetQueryString('userId'); // 用户ID
  var token = GetQueryString('playerHandle'); // TOKEN

  var link = "http://ext.na77.org/api/ttglogout/" + gameId + '/' + userId + '/' + token;
  let url = http + key + end;
  iframe.src = url;


  // 生成按钮
  var new_element_N = document.createElement("style");
  new_element_N.innerHTML = '#drager {' +
    '   position: fixed;' +
    '   width: 35px;' +
    '   height: 35px;' +
    '   background-color: rgba(0, 0, 0, 0.2);' +
    '   z-index: 10000;' +
    '   cursor: pointer;' +
    '   top: 0px;' +
    '   left: 0px;' +
    '   border-radius: 30%;' +
    '   padding: 6px;' +
    ' }' +
    ' ' +
    ' #drager>div {' +
    '   border-radius: 50%;' +
    '   width: 100%;' +
    '   height: 100%;' +
    '   background-color: rgba(0, 0, 0, 0.3);' +
    '   transition: all 0.2s;' +
    '  -webkit-transition: all 0.2s;' +
    '  -moz-transition: all 0.2s;' +
    '  -o-transition: all 0.2s;' +
    ' }' +
    ' #drager:hover>div{' +
    '   background-color: rgba(0, 0, 0, 0.6);' +
    ' } ';
  document.body.appendChild(new_element_N);
  new_element_N = document.createElement('div');
  new_element_N.setAttribute("id", "drager");
  new_element_N.style.top = "100px";
  new_element_N.style.left = "100px";
  new_element_N.innerHTML = ' <div></div>';
  document.body.appendChild(new_element_N);
  var posX;
  var posY;
  var screenWidth = document.documentElement.clientWidth;
  var screenHeight = document.documentElement.clientHeight;
  var fdiv = document.getElementById("drager");
  fdiv.onmousedown = function (e) {
    fdiv.style.backgroundColor = "rgba(0, 0, 0, 0.3)"
    screenWidth = document.documentElement.clientWidth;
    screenHeight = document.documentElement.clientHeight;
    if (!e) { e = window.event; } //IE
    posX = e.clientX - parseInt(fdiv.style.left);
    posY = e.clientY - parseInt(fdiv.style.top);
    document.onmousemove = mousemove;
  }
  fdiv.touchstart = function () {
  }
  fdiv.onclick = function () {
    var r = confirm("是否退出游戏？")
    if (r) {
      var ajax = new XMLHttpRequest();
      ajax.open('get', link);
      ajax.send();
      console.log('1111')
      console.log(ajax)
      ajax.onreadystatechange = function () {
        console.log('2222')
        console.log(ajax)
        console.log(ajax.status)
        console.log(ajax.readyState)
        if (ajax.status == 200) {
          alert('已退出')
          window.close()
        } else {
          alert('退出失败！请重试')
        }
      }
    } else {
      alert('已取消退出！')
    }
  }
  document.onmouseup = function ()//释放时自动贴到最近位置
  {
    document.onmousemove = null;
    if ((parseInt(fdiv.style.top) + parseInt(fdiv.clientHeight) / 2) <= (screenHeight / 2)) {//在上半部分
      if ((parseInt(fdiv.style.left) + parseInt(fdiv.clientWidth) / 2) <= (screenWidth / 2)) {//在左半部分
        if ((parseInt(fdiv.style.top) + parseInt(fdiv.clientHeight) / 2) <= (parseInt(fdiv.style.left) + parseInt(fdiv.clientWidth) / 2)) {//靠近上方
          fdiv.style.top = "0px";
        } else {//靠近左边
          fdiv.style.left = "0px";
        }
      } else {//在右半部分
        if ((parseInt(fdiv.style.top) + parseInt(fdiv.clientHeight) / 2) <= (screenWidth - (parseInt(fdiv.style.left) + parseInt(fdiv.clientWidth) / 2))) {//靠近上方
          fdiv.style.top = "0px";
        } else {//靠近右边
          fdiv.style.left = (screenWidth - parseInt(fdiv.clientWidth)) + "px";
        }
      }
    } else { //下半部分
      if ((parseInt(fdiv.style.left) + parseInt(fdiv.clientWidth) / 2) <= (screenWidth / 2)) {//在左半部分
        if ((screenHeight - (parseInt(fdiv.style.top) + parseInt(fdiv.clientHeight) / 2)) <= (parseInt(fdiv.style.left) + parseInt(fdiv.clientWidth) / 2)) {//靠近下方
          fdiv.style.top = (screenHeight - parseInt(fdiv.clientHeight)) + "px";
        } else {//靠近左边
          fdiv.style.left = "0px";
        }
      } else {//在右半部分
        if ((screenHeight - (parseInt(fdiv.style.top) + parseInt(fdiv.clientHeight) / 2)) <= (screenWidth - (parseInt(fdiv.style.left) + parseInt(fdiv.clientWidth) / 2))) {//靠近上方
          fdiv.style.top = (screenHeight - parseInt(fdiv.clientHeight)) + "px";
        } else {//靠近右边
          fdiv.style.left = (screenWidth - parseInt(fdiv.clientWidth)) + "px";
        }
      }
    }
    fdiv.style.backgroundColor = "rgba(0, 0, 0, 0.6)"
  }
  function mousemove(ev) {
    if (ev == null) { ev = window.event; }//IE
    if ((ev.clientY - posY) <= 0) {//超过顶部
      fdiv.style.top = "0px";
    } else if ((ev.clientY - posY) > (screenHeight - parseInt(fdiv.clientHeight))) {//超过底部
      fdiv.style.top = (screenHeight - parseInt(fdiv.clientHeight)) + "px";
    } else {
      fdiv.style.top = (ev.clientY - posY) + "px";
    }

    if ((ev.clientX - posX) <= 0) {//超过左边
      fdiv.style.left = "0px";
    } else if ((ev.clientX - posX) > (screenWidth - parseInt(fdiv.clientWidth))) {//超过右边
      fdiv.style.left = (screenWidth - parseInt(fdiv.clientWidth)) + "px";
    } else {
      fdiv.style.left = (ev.clientX - posX) + "px";
    }
    // console.log( posX +" "+ fdiv.style.left);

  }
  window.onload = window.onresize = function () { //窗口大小改变事件
    screenWidth = document.documentElement.clientWidth;
    screenHeight = document.documentElement.clientHeight;
    if ((parseInt(fdiv.style.top) + parseInt(fdiv.clientHeight)) > screenHeight) {//窗口改变适应超出的部分
      fdiv.style.top = (screenHeight - parseInt(fdiv.clientHeight)) + "px";
    }
    if ((parseInt(fdiv.style.left) + parseInt(fdiv.clientWidth)) > screenWidth) {//窗口改变适应超出的部分
      fdiv.style.left = (screenWidth - parseInt(fdiv.clientWidth)) + "px";
    }
    document.onmouseup.apply()
  };
  fdiv.addEventListener('touchstart', fdiv.onmousedown, false);
  fdiv.addEventListener('touchmove', function (event) {
    // 如果这个元素的位置内只有一个手指的话
    if (event.targetTouches.length == 1) {
      event.preventDefault();// 阻止浏览器默认事件，重要 
      var touch = event.targetTouches[0];
      if ((touch.pageY) <= 0) {//超过顶部
        fdiv.style.top = "0px";
      } else if (touch.pageY > (screenHeight - parseInt(fdiv.clientHeight))) {//超过底部
        fdiv.style.top = (screenHeight - parseInt(fdiv.clientHeight)) + "px";
      } else {
        fdiv.style.top = (touch.pageY - parseInt(fdiv.clientHeight) / 2) + "px";
      }

      if (touch.pageX <= 0) {//超过左边
        fdiv.style.left = "0px";
      } else if (touch.pageX > (screenWidth - parseInt(fdiv.clientWidth))) {//超过右边
        fdiv.style.left = (screenWidth - parseInt(fdiv.clientWidth)) + "px";
      } else {
        fdiv.style.left = (touch.pageX - parseInt(fdiv.clientWidth) / 2) + "px";
      }
    }
  }, false);
  fdiv.addEventListener('touchend', document.onmouseup, false);    
</script>

</html>